<!doctype html>
<html lang="zh-Hans">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <title>Yoyi çš„å‹å²é’±å°è´¦æœ¬</title>
  <!-- Optional: if you upload icon.png in the same folder, these will work -->
  <link rel="apple-touch-icon" sizes="180x180" href="icon.png">
  <link rel="icon" href="icon.png">

  <style>
    :root{
      --bg:#f4f6fb;
      --card:#ffffff;
      --text:#0b1220;
      --muted:#667085;
      --line:#e7eaf1;
      --shadow: 0 10px 30px rgba(15, 23, 42, .08);
      --primary:#111827;
      --danger:#d92d20;
      --ok:#16a34a;
      --pill:#eef2ff;
      --radius:22px;
      --btnRadius:16px;
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      background:linear-gradient(180deg, #f7f9ff 0%, var(--bg) 55%, var(--bg) 100%);
      color:var(--text);
      font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text","PingFang SC","Hiragino Sans GB","Microsoft YaHei", system-ui, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
    }

    .wrap{
      max-width: 720px; /* keep iPad looking like â€œmobileâ€ */
      margin: 0 auto;
      padding: 18px 16px 44px;
    }

    .title{
      display:flex;
      align-items:flex-start;
      gap:10px;
      padding-top: 6px;
    }
    .title h1{
      margin: 4px 0 4px;
      font-size: 30px;
      line-height: 1.1;
      letter-spacing: .2px;
    }
    .subtitle{
      color:var(--muted);
      font-size: 14px;
      line-height: 1.45;
      margin-top: 6px;
    }

    .card{
      background:var(--card);
      border:1px solid rgba(231,234,241,.9);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
    }

    .balances{
      margin-top: 14px;
      padding: 18px 16px;
    }
    .balRow{
      display:flex;
      align-items:baseline;
      justify-content:flex-start;
      gap:12px;
      margin: 8px 0;
      font-size: 18px;
    }
    .balLabel{
      min-width: 120px;
      display:flex;
      align-items:center;
      gap:10px;
      font-weight: 700;
    }
    .balAmt{
      font-size: 34px;
      font-weight: 900;
      letter-spacing: .2px;
    }
    .yen{ font-size: 18px; font-weight: 800; margin-left:4px; color:var(--muted); }

    .section{
      margin-top: 16px;
      padding: 16px;
    }
    .section h2{
      margin: 0 0 12px;
      font-size: 22px;
      letter-spacing: .2px;
    }

    label{
      display:block;
      font-size: 13px;
      color: var(--muted);
      margin: 10px 0 6px;
    }

    .grid{
      display:grid;
      grid-template-columns: 1fr;
      gap: 10px;
    }

    select,input,textarea{
      width:100%;
      font-size:16px;
      padding: 12px 14px;
      border-radius: 14px;
      border:1px solid var(--line);
      background:#fff;
      outline:none;
    }
    textarea{ min-height: 46px; resize: vertical; }

    .row2{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
    }

    .btnRow{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      margin-top: 12px;
    }
    button{
      border:1px solid transparent;
      background:#fff;
      padding: 12px 14px;
      border-radius: var(--btnRadius);
      font-size: 16px;
      cursor:pointer;
      -webkit-tap-highlight-color: transparent;
    }
    .primary{
      background: var(--primary);
      color:#fff;
    }
    .ghost{
      background:#fff;
      border-color: var(--line);
      color: var(--text);
    }
    .danger{
      background:#fff;
      border-color: rgba(217,45,32,.35);
      color: var(--danger);
    }
    .dangerFill{
      background: rgba(217,45,32,.07);
      border-color: rgba(217,45,32,.25);
      color: var(--danger);
    }
    .small{
      padding: 10px 12px;
      font-size: 15px;
      border-radius: 14px;
    }

    .hint{
      font-size: 14px;
      color: var(--muted);
      line-height: 1.5;
      margin: 8px 0 0;
    }

    /* List as cards ALWAYS */
    .listWrap{
      margin-top: 8px;
    }

    .empty{
      text-align:center;
      color: var(--muted);
      font-size: 14px;
      padding: 22px 0 10px;
    }

    .txCard{
      border:1px solid var(--line);
      background:#fff;
      border-radius: 18px;
      padding: 14px 14px;
      margin-top: 12px;
    }
    .txTop{
      display:flex;
      justify-content:space-between;
      gap:12px;
      align-items:flex-start;
    }
    .txTitle{
      font-size: 22px;
      font-weight: 900;
      letter-spacing:.2px;
      line-height: 1.25;
    }
    .txAmt{
      font-size: 26px;
      font-weight: 900;
      white-space:nowrap;
    }
    .amtPlus{ color: var(--ok); }
    .amtMinus{ color: var(--danger); }

    .txMeta{
      margin-top: 6px;
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      color: var(--muted);
      font-size: 14px;
      align-items:center;
    }
    .pill{
      background: var(--pill);
      border: 1px solid rgba(99,102,241,.18);
      color: #3b3f98;
      padding: 4px 10px;
      border-radius: 999px;
      font-size: 13px;
      font-weight: 700;
    }
    .txBtns{
      margin-top: 10px;
      display:flex;
      justify-content:flex-end;
      gap:10px;
    }

    .footerTag{
      margin: 20px auto 0;
      width: fit-content;
      padding: 8px 14px;
      background: rgba(255,255,255,.75);
      border:1px solid rgba(231,234,241,.9);
      border-radius: 999px;
      color: rgba(11,18,32,.65);
      font-weight: 700;
      font-size: 14px;
    }

    /* keep form nice on small screens */
    @media (max-width: 420px){
      .row2{ grid-template-columns: 1fr; }
      .balAmt{ font-size: 30px; }
      .txTitle{ font-size: 20px; }
      .txAmt{ font-size: 24px; }
      .balLabel{ min-width: 110px; }
    }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="title">
      <div style="font-size:28px; line-height:1; margin-top:6px;">ğŸ§¸</div>
      <div>
        <h1>Yoyi çš„å‹å²é’±å°è´¦æœ¬</h1>
        <div class="subtitle">
          ä¸‰è´¦æˆ·ï¼š ğŸ’° Saveï¼ˆæœªæ¥ï¼‰ï½œğŸ Wishï¼ˆæ„¿æœ›ï¼‰ï½œâ¤ï¸ Giveï¼ˆå¸®åŠ©ï¼‰<br/>
          æ•°æ®ä¿å­˜åœ¨æœ¬æœºæµè§ˆå™¨ï¼ˆå»ºè®®å¶å°”å¯¼å‡º CSV å¤‡ä»½ï¼‰
        </div>
      </div>
    </div>

    <div class="card balances" id="balCard">
      <div class="balRow">
        <div class="balLabel">ğŸ’° Save:</div>
        <div><span class="balAmt" id="balSave">0</span><span class="yen">Â¥</span></div>
      </div>
      <div class="balRow">
        <div class="balLabel">ğŸ Wish:</div>
        <div><span class="balAmt" id="balWish">0</span><span class="yen">Â¥</span></div>
      </div>
      <div class="balRow">
        <div class="balLabel">â¤ï¸ Give:</div>
        <div><span class="balAmt" id="balGive">0</span><span class="yen">Â¥</span></div>
      </div>
    </div>

    <div class="card section">
      <h2>âœï¸ æ·»åŠ  / ä¿®æ”¹ä¸€ç¬”è®°å½•</h2>

      <div class="grid">
        <div class="row2">
          <div>
            <label>è´¦æˆ·</label>
            <select id="acct">
              <option value="save">Saveï¼ˆå‚¨è“„ï¼‰</option>
              <option value="wish">Wishï¼ˆæ„¿æœ›ï¼‰</option>
              <option value="give">Giveï¼ˆå¸®åŠ©ï¼‰</option>
            </select>
          </div>
          <div>
            <label>ç±»å‹</label>
            <select id="type">
              <option value="in">+ å­˜å…¥</option>
              <option value="out">âˆ’ æ”¯å‡º</option>
            </select>
          </div>
        </div>

        <div>
          <label>é‡‘é¢ï¼ˆJPYï¼‰</label>
          <input id="amount" inputmode="numeric" placeholder="ä¾‹å¦‚ 20000" />
        </div>

        <div>
          <label>æ—¥æœŸ</label>
          <input id="date" type="date" />
        </div>

        <div>
          <label>åˆ†ç±»ï¼ˆå¯é€‰ï¼‰</label>
          <select id="cat">
            <option value="">ï¼ˆä¸é€‰ä¹Ÿå¯ä»¥ï¼‰</option>
            <option value="gift">ç¤¼ç‰©</option>
            <option value="toy">ç©å…·/ä¹é«˜</option>
            <option value="trip">æ—…è¡Œ/çºªå¿µå“</option>
            <option value="donation">æèµ /å¸®åŠ©</option>
            <option value="snack">é›¶é£Ÿ/å°åƒ</option>
            <option value="stationery">æ–‡å…·</option>
            <option value="other">å…¶ä»–</option>
          </select>
        </div>

        <div>
          <label>å¤‡æ³¨ï¼ˆå¯é€‰ï¼‰</label>
          <input id="note" placeholder="ä¾‹å¦‚ï¼šå­¦æ ¡ææ¬¾ / ç”Ÿæ—¥ç¤¼ç‰© / ä¹é«˜å‡ºèµ„" />
        </div>

        <div class="btnRow">
          <button class="primary" id="saveBtn">ä¿å­˜è¿™ä¸€ç¬”</button>
          <button class="ghost" id="clearBtn">æ¸…ç©ºè¾“å…¥</button>
          <button class="ghost" id="exportBtn">å¯¼å‡ºCSV</button>
          <button class="dangerFill" id="resetBtn">æ¸…ç©ºæ‰€æœ‰æ•°æ®ï¼ˆè°¨æ…ï¼‰</button>
        </div>

        <div class="hint" id="modeHint">å°æŠ€å·§ï¼šæƒ³æ”¹ä¸€ç¬”ï¼Œç‚¹ä¸‹é¢è®°å½•å³ä¾§â€œç¼–è¾‘â€ã€‚</div>
      </div>
    </div>

    <div class="card section">
      <h2>ğŸ“’ è®°å½•åˆ—è¡¨ï¼ˆæœ€æ–°åœ¨ä¸Šé¢ï¼‰</h2>
      <div class="hint">è¿™é‡Œåªç®¡å‹å²é’±ä¸‰è´¦æˆ·å³å¯ï¼ˆé›¶èŠ±é’±å¯å¦è®°æˆ–ä¸è®°ï¼‰ã€‚</div>
      <div class="listWrap" id="list"></div>
      <div class="footerTag">sisiliang07.github.io</div>
    </div>
  </div>

<script>
(function(){
  const KEY = "yoyi_money_tracker_v1_cards";
  const el = id => document.getElementById(id);

  const acctEmoji = a => ({save:"ğŸ’°", wish:"ğŸ", give:"â¤ï¸"}[a] || "ğŸ’¼");
  const acctName  = a => ({save:"Save", wish:"Wish", give:"Give"}[a] || a);
  const catName = c => ({
    "":"â€”",
    "gift":"ç¤¼ç‰©",
    "toy":"ç©å…·/ä¹é«˜",
    "trip":"æ—…è¡Œ/çºªå¿µå“",
    "donation":"æèµ /å¸®åŠ©",
    "snack":"é›¶é£Ÿ/å°åƒ",
    "stationery":"æ–‡å…·",
    "other":"å…¶ä»–"
  }[c] || c);

  const todayISO = () => {
    const d = new Date();
    const tz = d.getTimezoneOffset()*60000;
    return new Date(Date.now()-tz).toISOString().slice(0,10);
  };

  function load(){
    try{
      const raw = localStorage.getItem(KEY);
      if(!raw) return { tx: [] };
      const data = JSON.parse(raw);
      if(!data || !Array.isArray(data.tx)) return { tx: [] };
      return data;
    }catch(e){
      return { tx: [] };
    }
  }

  function save(data){
    localStorage.setItem(KEY, JSON.stringify(data));
  }

  function yen(n){
    const x = Number(n)||0;
    return x.toLocaleString("ja-JP");
  }

  function computeBalances(tx){
    const bal = {save:0, wish:0, give:0};
    tx.forEach(t=>{
      const amt = Number(t.amount)||0;
      if(!bal.hasOwnProperty(t.acct)) return;
      bal[t.acct] += (t.type === "in" ? amt : -amt);
    });
    return bal;
  }

  function setBalances(){
    const data = load();
    const bal = computeBalances(data.tx);
    el("balSave").textContent = yen(bal.save);
    el("balWish").textContent = yen(bal.wish);
    el("balGive").textContent = yen(bal.give);
  }

  let editingId = null;

  function clearForm(){
    editingId = null;
    el("acct").value = "save";
    el("type").value = "in";
    el("amount").value = "";
    el("date").value = todayISO();
    el("cat").value = "";
    el("note").value = "";
    el("saveBtn").textContent = "ä¿å­˜è¿™ä¸€ç¬”";
    el("modeHint").textContent = "å°æŠ€å·§ï¼šæƒ³æ”¹ä¸€ç¬”ï¼Œç‚¹ä¸‹é¢è®°å½•å³ä¾§â€œç¼–è¾‘â€ã€‚";
  }

  function validateAmount(){
    const raw = (el("amount").value || "").replace(/[,\s]/g,"");
    if(raw === "") return {ok:false, msg:"è¯·è¾“å…¥é‡‘é¢ã€‚"};
    const amt = Number(raw);
    if(!Number.isFinite(amt) || amt <= 0) return {ok:false, msg:"é‡‘é¢è¦æ˜¯å¤§äº 0 çš„æ•°å­—ã€‚"};
    return {ok:true, amt: Math.floor(amt)};
  }

  function canAfford(acct, outAmt, data, ignoreId){
    const tx = data.tx.filter(t=> t.id !== ignoreId);
    const bal = computeBalances(tx)[acct] || 0;
    return bal - outAmt >= 0;
  }

  function addOrUpdate(){
    const data = load();
    const acct = el("acct").value;
    const type = el("type").value;
    const date = el("date").value || todayISO();
    const cat  = el("cat").value || "";
    const note = (el("note").value || "").trim();

    const v = validateAmount();
    if(!v.ok){ alert(v.msg); return; }
    const amount = v.amt;

    if(type === "out"){
      const ok = canAfford(acct, amount, data, editingId);
      if(!ok){
        alert("è¿™ä¸ªè´¦æˆ·ä½™é¢ä¸è¶³ï¼Œä¸èƒ½æ”¯å‡ºè¿™ä¹ˆå¤šã€‚");
        return;
      }
    }

    if(editingId){
      const idx = data.tx.findIndex(t=>t.id===editingId);
      if(idx >= 0){
        data.tx[idx] = { ...data.tx[idx], acct, type, amount, date, cat, note };
      }
      editingId = null;
    }else{
      const id = String(Date.now()) + "_" + Math.random().toString(16).slice(2);
      data.tx.push({ id, acct, type, amount, date, cat, note });
    }

    data.tx.sort((a,b)=>{
      if(a.date !== b.date) return a.date < b.date ? 1 : -1;
      return a.id < b.id ? 1 : -1;
    });

    save(data);
    clearForm();
    render();
  }

  function startEdit(id){
    const data = load();
    const t = data.tx.find(x=>x.id===id);
    if(!t) return;
    editingId = id;
    el("acct").value = t.acct;
    el("type").value = t.type;
    el("amount").value = String(t.amount);
    el("date").value = t.date || todayISO();
    el("cat").value = t.cat || "";
    el("note").value = t.note || "";
    el("saveBtn").textContent = "ä¿å­˜ä¿®æ”¹";
    el("modeHint").textContent = "æ­£åœ¨ç¼–è¾‘ï¼šæ”¹å®Œåç‚¹â€œä¿å­˜ä¿®æ”¹â€ã€‚æƒ³å–æ¶ˆå°±ç‚¹â€œæ¸…ç©ºè¾“å…¥â€ã€‚";
    window.scrollTo({top:0, behavior:"smooth"});
  }

  function delTx(id){
    const data = load();
    const t = data.tx.find(x=>x.id===id);
    if(!t) return;
    if(!confirm("ç¡®å®šåˆ é™¤è¿™æ¡è®°å½•å—ï¼Ÿ")) return;
    data.tx = data.tx.filter(x=>x.id!==id);
    save(data);
    if(editingId === id) clearForm();
    render();
  }

  function renderList(){
    const data = load();
    const list = el("list");
    list.innerHTML = "";

    if(data.tx.length === 0){
      const d = document.createElement("div");
      d.className = "empty";
      d.textContent = "è¿˜æ²¡æœ‰è®°å½•ã€‚å¯ä»¥å…ˆæŠŠä»Šå¹´çš„å‹å²é’±åˆ†é…å­˜å…¥ä¸‰è´¦æˆ·ã€‚";
      list.appendChild(d);
      return;
    }

    data.tx.forEach(t=>{
      const isOut = t.type === "out";
      const sign = isOut ? "-" : "+";
      const amtClass = isOut ? "amtMinus" : "amtPlus";

      const card = document.createElement("div");
      card.className = "txCard";

      const top = document.createElement("div");
      top.className = "txTop";

      const title = document.createElement("div");
      title.className = "txTitle";
      title.textContent = `${t.date} Â· ${acctEmoji(t.acct)} ${acctName(t.acct)}`;

      const amt = document.createElement("div");
      amt.className = "txAmt " + amtClass;
      amt.textContent = `${sign}Â¥${yen(t.amount)}`;

      top.appendChild(title);
      top.appendChild(amt);

      const meta = document.createElement("div");
      meta.className = "txMeta";

      const typeSpan = document.createElement("span");
      typeSpan.textContent = (isOut ? "âˆ’ æ”¯å‡º" : "+ å­˜å…¥");
      meta.appendChild(typeSpan);

      const catSpan = document.createElement("span");
      catSpan.className = "pill";
      catSpan.textContent = catName(t.cat || "");
      meta.appendChild(catSpan);

      if(t.note){
        const noteSpan = document.createElement("span");
        noteSpan.textContent = "Â· " + t.note;
        meta.appendChild(noteSpan);
      }

      const btns = document.createElement("div");
      btns.className = "txBtns";

      const editBtn = document.createElement("button");
      editBtn.className = "ghost small";
      editBtn.textContent = "ç¼–è¾‘";
      editBtn.onclick = ()=> startEdit(t.id);

      const delBtn = document.createElement("button");
      delBtn.className = "danger small";
      delBtn.textContent = "åˆ é™¤";
      delBtn.onclick = ()=> delTx(t.id);

      btns.appendChild(editBtn);
      btns.appendChild(delBtn);

      card.appendChild(top);
      card.appendChild(meta);
      card.appendChild(btns);

      list.appendChild(card);
    });
  }

  function render(){
    setBalances();
    renderList();
  }

  function exportCSV(){
    const data = load();
    const rows = [["date","account","type","amount_jpy","category","note"]];
    data.tx.forEach(t=>{
      rows.push([t.date, acctName(t.acct), t.type, t.amount, catName(t.cat||""), t.note||""]);
    });
    const csv = rows.map(r => r.map(x => `"${String(x).replace(/"/g,'""')}"`).join(",")).join("\n");
    const blob = new Blob([csv], {type:"text/csv;charset=utf-8"});
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = "yoyi_money_tracker.csv";
    a.click();
    URL.revokeObjectURL(url);
  }

  function resetAll(){
    if(!confirm("ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰æ•°æ®å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ã€‚")) return;
    localStorage.removeItem(KEY);
    clearForm();
    render();
  }

  el("saveBtn").addEventListener("click", addOrUpdate);
  el("clearBtn").addEventListener("click", clearForm);
  el("exportBtn").addEventListener("click", exportCSV);
  el("resetBtn").addEventListener("click", resetAll);

  el("date").value = todayISO();
  render();
})();
</script>
</body>
</html>
